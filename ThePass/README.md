# ***Виртуальная стажировка***
______
## *Pereval Rest API*

_[ФСТР](https://pereval.online/) заказала студентам SkillFactory разработать мобильное приложение для туристов, которое будет работать на Android и IOS. 
В горах они будут вносить данные о перевале в приложение и отправлять 
их в ФСТР, как только появится доступ в Интернет.
Модератор из федерации будет верифицировать и вносить в базу данных информацию, полученную от пользователей, а те в свою
очередь смогут увидеть в мобильном приложении статус модерации и просматривать базу с объектами, внесёнными другими._
______
## *Требования к Rest API:*
Когда турист поднимется на перевал, он сфотографирует его и внесёт нужную информацию с помощью мобильного приложения:
+ координаты объекта и его высоту;
+ название объекта;
+ несколько фотографий;
+ информацию о пользователе, который передал данные о перевале:
+ имя пользователя (ФИО строкой);
+ почта;
+ телефон.
После этого турист нажмёт кнопку «Отправить» в мобильном приложении. Мобильное приложение вызывает метод pereval.

**Метод `pereval` принимает JSON в теле запроса с информацией о перевале. Ниже находится пример такого JSON-а:**
```
{
    "beauty_name": "пер.",
    "title": "Дятлова",
    "other_titles": "перевал Дятлова",
    "connect": "что-то соединяет",
    "user": {
        "email": "abrakadabra@mail.ru",
        "fam": "Иванов",
        "name": "Иван",
        "otc": "Иванович",
        "phone": "895562855655"
    },
    "coords": {
        "latitude": "45.3842",
        "longitude": "7.1525",
        "height": "1200"
    },
    "level": {
        "winter": "1А",
        "spring": "1А",
        "summer": "1А",
        "autumn": "1А"
    },
    "status": "NW",
    "images": [{"data":"картинка1", "title":"Седловина"}, {"data":"картинка", "title":"Подъём"}]
}
```
Результат метода: JSON

+ status — код HTTP, целое число:
  + 500 — ошибка при выполнении операции;
  + 400 — Bad Request (при нехватке полей);
  + 200 — успех.
+ message — строка:
  + Причина ошибки (если она была);
  + Отправлено успешно;
  + Если отправка успешна, дополнительно возвращается id вставленной записи.
+ id — идентификатор, который был присвоен объекту при добавлении в базу данных.
### Примеры:

`{ "status": 500, "message": "Ошибка подключения к базе данных","id": null}`

`{ "status": 200, "message": "Отправлено успешно", "id": 42 }`

После того, как турист с помощью мобильного приложения добавит информацию о новом перевале, сотрудники ФСТР проведут модерацию для каждого нового объекта и поменяют поле status.
### Допустимые значения поля status:
+ new;
+ pending — если модератор взял в работу;
+ accepted — модерация прошла успешно;
+ rejected — модерация прошла, информация не принята.

## *Метод:*
`POST/pereval/`
#### Добавляет объект в базу данных

## *Метод:*
`GET/pereval/{id}/`
#### Выводит всю информацию об объекте

## *Метод:*
`PATCH/pereval/{id}/`
#### Позволяет отредактировать существующую запись, если она в статусе `new`. Редактировать можно все поля, `кроме` тех, что содержат в себе `ФИО`, `адрес электронной почты` и `номер телефона`. Метод принимает json. В качестве результата возвращаются два значения:
+ **state**:
  + **1** — если успешно удалось отредактировать запись в базе данных.
  + **0** — в противном случае.
+ **message** — сообщение о причине неудачного изменения.

## *Метод:*
`GET/pereval/?user__email={user_email}`
#### Выводит список данных обо всех объектах, которые пользователь с указанной почтой отправил на сервер. При реализации использована фильтрация по адресу электронной почты пользователя с помощью пакета django-filter
____
Документация сгенерирована при помощи пакета `drf-yasg`
`http://127.0.0.1:8000/swagger/`
____
Проект опубликован на хостинге `pythonanywhere`:
+ API Pereval: https://sergeytochilin.pythonanywhere.com/api/pereval/
+ Документация Swagger: https://sergeytochilin.pythonanywhere.com/swagger/
<hr>

